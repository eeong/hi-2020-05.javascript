var Slide = function(arg){
	this.slide = arg.slide;
	this.title = arg.slideTitle || null;
	if(this.title) this.title.push(this.title[0]);
	this.$slides = [];
	this.container = arg.container;
	this.$container = $(this.container);
	this.direction = arg.direction || 'horizental';
	this.delay = arg.delay || '3000';
	this.speed = arg.speed || '500';
	this.auto = arg.auto || 'false';
	this.pager= arg.pager || 'false';
	this.btnUse= arg.btnUse || 'true';
	this.viewCount = arg.viewCount || 4;
	this.init();

	return this;
}

Slide.prototype.init = function(){

	this.$container.css({"overflow": "hidden" , "position":"relative"})
	this.$wrapper = $('<div class="custom-wrapper custom-'+ this.direction +  ' " ></div>').appendTo(this.$container);


	for (var i in this.slide){
		var html ='';
		html += '<div class="custom-slide">';
		html += '<img src='+this.slide[i]+' class="custom-img slide">';
		if(this.title && this.title[i]) html += this.title[i];
		html += '</div>';
		if(this.direction === "horizental" || this.direction === "vertical") this.$slides.push( $(html).appendTo(this.$wrapper));
		if(this.direction === "fade") this.$slides.push($(html));
	}
	if(this.direction == "horizental" || this.direction == "vertical"){
		this.$slides.push($(this.$slides[0].clone()).appendTo(this.$wrapper));
	}

	this.last = this.$slides.length - 1;
	this.now = 0;

	if(this.btnUse){
		this.$btnPrev = $("<div class='btn-custom custom-prev'> 〈 </div>").appendTo(this.$container);
		this.$btnNext = $("<div class='btn-custom custom-next'> 〉 </div>").appendTo(this.$container);
		this.$btnPrev.click(this.onClickPrev.bind(this)); 
		this.$btnNext.click(this.onClickNext.bind(this));
	}
	
	if(this.pager){
		this.$pagerWrap = $('<div class="custom-pager-wrap"></div>').appendTo(this.$container);
		for(var i in this.slide){
		$("<div class='custom-pager'></div>").appendTo(this.$pagerWrap).click(this.onPagerClick.bind(this));
	}
	this.$pagerWrap.find(".custom-pager").eq(0).addClass("active");
	}

	if(this.auto){
		this.$container.mouseover(this.onMouseOver.bind(this)).mouseleave(this.onMouseLeave.bind(this));
		this.interval = setInterval(this.onInterval.bind(this) , this.delay);
	}

	var html = '<img src='+ this.slide[0] + ' style="width:100%; opacity:0">';
	this.$container.append(html);

}

Slide.prototype.onPagerClick = function(e){
	this.now = $(e.currentTarget).index();
	this.ani();
}

Slide.prototype.onMouseOver = function(){
	clearInterval(this.interval);

}

Slide.prototype.onMouseLeave = function(){
	this.interval =setInterval(this.onInterval.bind(this) , this.delay);
}

Slide.prototype.onClickPrev = function(e){
	if(this.now == 0) {
		if(this.direction ==="horizental" || this.direction === "vertical"){
			this.now = this.last - 1;
			this.$wrapper.css(this.direction === 'horizental' ? 'left' : 'top', -100 * this.last+ "%"); 
		}
		if(this.direction === "fade")	this.now = this.last;
	}
	else this.now--;
	
	this.ani();
};

Slide.prototype.onClickNext = function(e){
	if(this.now == this.last){
		if(this.direction ==="horizental" || this.direction === "vertical"){	this.now = 1;
		this.$wrapper.css(this.direction === 'horizental' ? 'left' : 'top',0);}
		if(this.direction === "fade") this.now = 0;
	}else this.now++;
	this.ani();
}


Slide.prototype.onInterval = function(){
if(this.auto === "true") this.onClickNext();
}

Slide.prototype.ani = function(){

	if(this.pager){
		this.$pagerWrap.find(".custom-pager").eq(this.now).addClass("active").siblings().removeClass("active");
		$(".custom-pager").eq(this.now).addClass("active");
		if(this.now == this.last) this.$pagerWrap.find(".custom-pager").eq(0).addClass("active").siblings().removeClass("active");
	}

	if(this.direction == "horizental"){
		this.$wrapper.stop().animate({"left": -100*this.now+ "%"} , this.speed);
	}
	else if(this.direction == "vertical"){
		this.$wrapper.stop().animate({"top": -100*this.now+ "%"} , this.speed);
	}
	else {
		$(this.$slides[this.now].clone()).appendTo(this.$wrapper).css("opacity",0).stop().animate({opacity: 1 } , this.speed , function(){
			$(this).prev().remove();
		});
	}
}


(function(){
	/* 전역변수 선언 */
	var slides = [
		{ id: 0, src: '../img/lx-2-0.jpg', title: '침대1' },
		{ id: 1, src: '../img/lx-2-1.jpg', title: '침대2' },
		{ id: 2, src: '../img/lx-2-2.jpg', title: '침대3' },
		{ id: 3, src: '../img/lx-5-0.jpg', title: '쇼파1' },
		{ id: 4, src: '../img/lx-5-1.jpg', title: '쇼파2' },
		{ id: 5, src: '../img/lx-5-2.jpg', title: '쇼파3' },
		{ id: 6, src: '../img/lx-3-0.jpg', title: '의자1' },
		{ id: 7, src: '../img/lx-3-1.jpg', title: '의자2' },
		{ id: 8, src: '../img/lx-3-2.jpg', title: '의자3' },
		{ id: 9, src: '../img/lx-6-0.jpg', title: '쇼파4' },
		{ id: 10, src: '../img/lx-6-1.jpg', title: '쇼파5' },
		{ id: 11, src: '../img/lx-6-2.jpg', title: '쇼파6' }
	];	
	var $wrapper = $(".wrapper8");
	var $slideWrap = $(".wrapper8 .slide-wrap");
	var $btnPrev = $(".btn-prev", $wrapper);
	var $btnNext = $(".btn-next", $wrapper);
	var $slides = [];
	var idx = 0;
	var lastIdx  = slides.length-1;
	var slideNum = 4;
	var target;
	var winWid = $(window).outerWidth();
	var interval;
	/* 사용자 함수 */
	init();
	function init(){
		var i, html;
		for (var i in slides){
			html = "<div class='slide'>";
			html += "<img class='w-100' src='"+slides[i].src+"'>";
			html += "<h1>"+i+"</h1>";
			html += "</div>";
			$slides.push($(html));
		}
		slideInit();
		interval = setInterval(onClickNext,3000);
	}

	function slideInit(){
		$btnNext.off("click").click(onClickNext);
		$btnPrev.off("click").click(onClickPrev);
		$($slides[idx].clone()).appendTo($slideWrap.empty().attr("style",""));
		if (idx == 0)
			$($slides[lastIdx].clone()).prependTo($slideWrap);
			else 
			$($slides[idx-1].clone()).prependTo($slideWrap);
			
		for( var i = 1; i<=slideNum; i++){
			if((idx+i) > lastIdx) $($slides[-(lastIdx - (idx+i))-1].clone()).appendTo($slideWrap);
			else $($slides[idx+i].clone()).appendTo($slideWrap);
		}
	}

	function ani(){
		$slideWrap.stop().animate({"left": target+"%"}, 500, slideInit);
		}

	/* 이벤트 콜백 */
	function onClickNext(){
		$(this).off("click");
		idx = idx == lastIdx ? 0 : idx + 1;
		if(winWid < 576){
			target = -200;
		} else if(winWid < 768){
			target = -100;
		} else if(winWid < 992){
			target = -66.6666;
		} else {
			target = -50; 
		}  
		ani();
		
	}
	
	function onClickPrev(){
		$(this).off("click");
		idx = idx == 0 ? lastIdx : idx - 1;
		target=0;
		ani();
	}	
	/* 이벤트 등록 */

	$btnPrev.click(onClickPrev);
	$btnNext.click(onClickNext);
	$wrapper.mouseover(function(){
		clearInterval(interval);
	}).mouseleave(function(){
		interval = setInterval(onClickNext,3000);
	});
	
})();



Slide.prototype.startInit = function(){


}